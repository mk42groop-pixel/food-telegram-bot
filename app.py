import os
import logging
import requests
import json
import time
import schedule
import hashlib
import re
from datetime import datetime, timedelta
from threading import Thread, Lock
from flask import Flask, request, jsonify, render_template_string
import pytz
import random
from dotenv import load_dotenv
from functools import wraps
import sqlite3
from contextlib import contextmanager
import signal
import sys
import atexit

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

app = Flask(__name__)

# ========== –£–°–ò–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê KEEP-ALIVE ==========

class EnhancedKeepAlive:
    def __init__(self):
        self.ping_count = 0
        self.last_ping_time = None
        self.failed_pings = 0
        self.max_failed_pings = 3

    def multi_layer_ping(self):
        """–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–∏–Ω–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–Ω–∞"""
        try:
            port = int(os.environ.get('PORT', 8080))
            current_time = datetime.now()

            # –£—Ä–æ–≤–µ–Ω—å 1: –ü–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è
            health_response = requests.get(f"http://localhost:{port}/health", timeout=5)

            # –£—Ä–æ–≤–µ–Ω—å 2: –ü–∏–Ω–≥ –¥–∞—à–±–æ—Ä–¥–∞
            dashboard_response = requests.get(f"http://localhost:{port}/", timeout=10)

            # –£—Ä–æ–≤–µ–Ω—å 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
            schedule.run_pending()

            self.ping_count += 1
            self.last_ping_time = current_time
            self.failed_pings = 0

            logger.info(f"‚úÖ Keep-alive #{self.ping_count} | Health: {health_response.status_code}")

            # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç
            if self.ping_count % 10 == 0:
                self._log_uptime_report()

        except Exception as e:
            self.failed_pings += 1
            logger.warning(f"‚ö†Ô∏è Keep-alive –æ—à–∏–±–∫–∞ #{self.failed_pings}: {e}")

            if self.failed_pings >= self.max_failed_pings:
                logger.error("üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ failed pings!")
                self._emergency_restart()

    def _log_uptime_report(self):
        """–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –æ —Ä–∞–±–æ—Ç–µ"""
        jobs = schedule.get_jobs()
        logger.info(f"üìä Keep-alive –æ—Ç—á–µ—Ç: {self.ping_count} –ø–∏–Ω–≥–æ–≤ | –ó–∞–¥–∞–Ω–∏–π: {len(jobs)}")

    def _emergency_restart(self):
        """–ê–≤–∞—Ä–∏–π–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        logger.critical("üîÑ –ê–í–ê–†–ò–ô–ù–´–ô –ü–ï–†–ï–ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´...")
        os.execv(sys.executable, ['python'] + sys.argv)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è enhanced keep-alive
enhanced_keep_alive = EnhancedKeepAlive()

def start_enhanced_keep_alive():
    """–ó–∞–ø—É—Å–∫ —É—Å–∏–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã keep-alive"""
    def keep_alive_cycle():
        while True:
            try:
                enhanced_keep_alive.multi_layer_ping()
                time.sleep(180)  # 3 –º–∏–Ω—É—Ç—ã
            except Exception as e:
                logger.error(f"üí• –û—à–∏–±–∫–∞ –≤ keep-alive —Ü–∏–∫–ª–µ: {e}")
                time.sleep(60)

    keep_alive_thread = Thread(target=keep_alive_cycle, daemon=True)
    keep_alive_thread.start()
    logger.info("üöÄ Keep-alive —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞")

# ========== –°–ò–°–¢–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò ==========

class SecurityManager:
    def __init__(self):
        self.rate_limits = {}
        self.max_requests_per_minute = 30
        
    def rate_limit_check(self, identifier):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤"""
        now = time.time()
        window = 60
        
        if identifier not in self.rate_limits:
            self.rate_limits[identifier] = []
        
        self.rate_limits[identifier] = [
            req_time for req_time in self.rate_limits[identifier] 
            if now - req_time < window
        ]
        
        if len(self.rate_limits[identifier]) >= self.max_requests_per_minute:
            return False
            
        self.rate_limits[identifier].append(now)
        return True
    
    def validate_content(self, content):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π"""
        if len(content) > 4000:
            return False, "–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
            
        forbidden_patterns = [
            r'http[s]?://(?!ppsupershef)',
            r'@(?!ppsupershef)',
        ]
        
        for pattern in forbidden_patterns:
            if re.search(pattern, content):
                return False, "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã"
                
        return True, "OK"

def require_auth(f):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"""
    @wraps(f)
    def decorated(*args, **kwargs):
        auth_header = request.headers.get('Authorization')
        expected_secret = os.getenv('API_SECRET')
        
        if not auth_header or not expected_secret:
            return jsonify({"status": "error", "message": "Auth required"}), 401
            
        if auth_header != f"Bearer {expected_secret}":
            return jsonify({"status": "error", "message": "Invalid token"}), 401
            
        return f(*args, **kwargs)
    return decorated

def rate_limit(f):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤"""
    @wraps(f)
    def decorated(*args, **kwargs):
        client_ip = request.remote_addr
        
        if not security_manager.rate_limit_check(client_ip):
            return jsonify({"status": "error", "message": "Rate limit exceeded"}), 429
            
        return f(*args, **kwargs)
    return decorated

# ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========

class Config:
    TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
    TELEGRAM_CHANNEL = os.getenv('TELEGRAM_CHANNEL', '-1003152210862')
    TELEGRAM_GROUP = os.getenv('TELEGRAM_GROUP', '@ppsupershef_chat')
    YANDEX_GPT_API_KEY = os.getenv('YANDEX_GPT_API_KEY')
    YANDEX_FOLDER_ID = os.getenv('YANDEX_FOLDER_ID', 'b1gb6o9sk0ajjfdaoev8')
    API_SECRET = os.getenv('API_SECRET', 'your-secret-key-here')
    SERVER_TZ = pytz.timezone('UTC')
    KEMEROVO_TZ = pytz.timezone('Asia/Novokuznetsk')

# ========== YANDEX GPT –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ==========

class YandexGPTGenerator:
    def __init__(self):
        self.api_key = Config.YANDEX_GPT_API_KEY
        self.folder_id = Config.YANDEX_FOLDER_ID
        self.base_url = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"

    def generate_recipe(self, recipe_type, theme):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ —á–µ—Ä–µ–∑ Yandex GPT"""
        try:
            if not self.api_key or self.api_key == 'your-yandex-gpt-api-key':
                return self._get_template_recipe(recipe_type, theme)

            prompt = self._build_prompt(recipe_type, theme)

            headers = {
                "Authorization": f"Api-Key {self.api_key}",
                "Content-Type": "application/json"
            }

            data = {
                "modelUri": f"gpt://{self.folder_id}/yandexgpt/latest",
                "completionOptions": {
                    "stream": False,
                    "temperature": 0.7,
                    "maxTokens": 1500
                },
                "messages": [
                    {
                        "role": "system",
                        "text": "–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥ –∏ —à–µ—Ñ-–ø–æ–≤–∞—Ä. –°–æ–∑–¥–∞–≤–∞–π –ø–æ–ª–µ–∑–Ω—ã–µ, –≤–∫—É—Å–Ω—ã–µ –∏ –ø—Ä–æ—Å—Ç—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –¥–ª—è —Å–µ–º—å–∏."
                    },
                    {
                        "role": "user", 
                        "text": prompt
                    }
                ]
            }

            response = requests.post(self.base_url, headers=headers, json=data, timeout=30)

            if response.status_code == 200:
                result = response.json()
                recipe_text = result['result']['alternatives'][0]['message']['text']
                logger.info("‚úÖ –†–µ—Ü–µ–ø—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Yandex GPT")
                return self._format_recipe(recipe_text, recipe_type, theme)
            else:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ Yandex GPT: {response.status_code}")
                return self._get_template_recipe(recipe_type, theme)

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–∞: {e}")
            return self._get_template_recipe(recipe_type, theme)

    def _build_prompt(self, recipe_type, theme):
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è GPT"""
        prompts = {
            'breakfast': f"–°–æ–∑–¥–∞–π —Ä–µ—Ü–µ–ø—Ç –ø–æ–ª–µ–∑–Ω–æ–≥–æ —Å–µ–º–µ–π–Ω–æ–≥–æ –∑–∞–≤—Ç—Ä–∞–∫–∞ –Ω–∞ —Ç–µ–º—É '{theme}'. –í–∫–ª—é—á–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 4 —á–µ–ª–æ–≤–µ–∫ –∏ –ø–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ.",
            'lunch': f"–°–æ–∑–¥–∞–π —Ä–µ—Ü–µ–ø—Ç –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–µ–º–µ–π–Ω–æ–≥–æ –æ–±–µ–¥–∞ –Ω–∞ —Ç–µ–º—É '{theme}'. –í–∫–ª—é—á–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 4 —á–µ–ª–æ–≤–µ–∫ –∏ –ø–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ.", 
            'dinner': f"–°–æ–∑–¥–∞–π —Ä–µ—Ü–µ–ø—Ç –ª–µ–≥–∫–æ–≥–æ —Å–µ–º–µ–π–Ω–æ–≥–æ —É–∂–∏–Ω–∞ –Ω–∞ —Ç–µ–º—É '{theme}'. –í–∫–ª—é—á–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 4 —á–µ–ª–æ–≤–µ–∫ –∏ –ø–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ.",
            'dessert': f"–°–æ–∑–¥–∞–π —Ä–µ—Ü–µ–ø—Ç –ø–æ–ª–µ–∑–Ω–æ–≥–æ –¥–µ—Å–µ—Ä—Ç–∞ –¥–ª—è —Å–µ–º—å–∏ –Ω–∞ —Ç–µ–º—É '{theme}'. –í–∫–ª—é—á–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–∞ 4 —á–µ–ª–æ–≤–µ–∫ –∏ –ø–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ.",
            'advice': f"–î–∞–π –ø–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞ –Ω–∞ —Ç–µ–º—É '{theme}' –¥–ª—è —Å–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏."
        }

        return prompts.get(recipe_type, prompts['breakfast'])

    def _format_recipe(self, recipe_text, recipe_type, theme):
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞"""
        emoji_map = {
            'breakfast': 'üç≥', 'lunch': 'üç≤', 'dinner': 'üçΩÔ∏è', 
            'dessert': 'üç∞', 'advice': 'üí°'
        }

        emoji = emoji_map.get(recipe_type, 'üçΩÔ∏è')
        return f"{emoji} <b>{theme.upper()}</b>\n\n{recipe_text}"

    def _get_template_recipe(self, recipe_type, theme):
        """–†–µ–∑–µ—Ä–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã"""
        templates = {
            'neuro_breakfast': """
üçΩÔ∏è <b>–û–ú–õ–ï–¢ –° –õ–û–°–û–°–ï–ú –ò –ê–í–û–ö–ê–î–û</b>

üìä <b>–ü–ò–©–ï–í–ê–Ø –¶–ï–ù–ù–û–°–¢–¨ –ù–ê –ü–û–†–¶–ò–Æ:</b>
‚Ä¢ üî• –ö–∞–ª–æ—Ä–∏–∏: 320 –∫–∫–∞–ª
‚Ä¢ üçó –ë–µ–ª–∫–∏: 25 –≥
‚Ä¢ ü•ë –ñ–∏—Ä—ã: 22 –≥  
‚Ä¢ üåæ –£–≥–ª–µ–≤–æ–¥—ã: 8 –≥

üõí <b>–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ –ù–ê 4 –ü–û–†–¶–ò–ò:</b>
‚Ä¢ ü•ö –Ø–π—Ü–∞ - 8 —à—Ç
‚Ä¢ üêü –õ–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª–µ–Ω—ã–π - 200 –≥
‚Ä¢ ü•ë –ê–≤–æ–∫–∞–¥–æ - 2 —à—Ç
‚Ä¢ ü•¨ –®–ø–∏–Ω–∞—Ç - 100 –≥
‚Ä¢ üßÄ –°—ã—Ä —Ñ–µ—Ç–∞ - 100 –≥
‚Ä¢ üçÖ –ü–æ–º–∏–¥–æ—Ä—ã —á–µ—Ä—Ä–∏ - 150 –≥
‚Ä¢ ü´í –û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ - 2 —Å—Ç.–ª.
‚Ä¢ üå∂Ô∏è –°–ø–µ—Ü–∏–∏: –∫—É—Ä–∫—É–º–∞, —á–µ—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü

üë®‚Äçüç≥ <b>–ü–†–û–¶–ï–°–° –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø:</b>
1. ü•ö –Ø–π—Ü–∞ –≤–∑–±–∏—Ç—å —Å –∫—É—Ä–∫—É–º–æ–π –∏ –ø–µ—Ä—Ü–µ–º
2. ü•ë –ê–≤–æ–∫–∞–¥–æ –Ω–∞—Ä–µ–∑–∞—Ç—å –∫—É–±–∏–∫–∞–º–∏
3. ü•¨ –ù–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –æ–±–∂–∞—Ä–∏—Ç—å —à–ø–∏–Ω–∞—Ç
4. üç≥ –ó–∞–ª–∏—Ç—å —è–π—Ü–∞–º–∏, –¥–æ–±–∞–≤–∏—Ç—å –∞–≤–æ–∫–∞–¥–æ –∏ –ø–æ–º–∏–¥–æ—Ä—ã
5. üî• –ì–æ—Ç–æ–≤–∏—Ç—å –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –æ–≥–Ω–µ 7-8 –º–∏–Ω—É—Ç
6. üßÄ –ü–æ—Å—ã–ø–∞—Ç—å —Å—ã—Ä–æ–º —Ñ–µ—Ç–∞ –∏ –ª–æ—Å–æ—Å–µ–º

üç¥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>""",
            'protein_breakfast': """
üçΩÔ∏è <b>–¢–í–û–†–û–ñ–ù–ê–Ø –ó–ê–ü–ï–ö–ê–ù–ö–ê</b>

üìä <b>–ü–ò–©–ï–í–ê–Ø –¶–ï–ù–ù–û–°–¢–¨ –ù–ê –ü–û–†–¶–ò–Æ:</b>
‚Ä¢ üî• –ö–∞–ª–æ—Ä–∏–∏: 280 –∫–∫–∞–ª
‚Ä¢ üçó –ë–µ–ª–∫–∏: 30 –≥
‚Ä¢ ü•ë –ñ–∏—Ä—ã: 12 –≥  
‚Ä¢ üåæ –£–≥–ª–µ–≤–æ–¥—ã: 15 –≥

üõí <b>–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ –ù–ê 4 –ü–û–†–¶–ò–ò:</b>
‚Ä¢ üßÄ –¢–≤–æ—Ä–æ–≥ 5% - 600 –≥
‚Ä¢ ü•ö –Ø–π—Ü–∞ - 3 —à—Ç
‚Ä¢ üåæ –ú–∞–Ω–∫–∞ - 3 —Å—Ç.–ª.
‚Ä¢ üçØ –ú–µ–¥ - 3 —Å—Ç.–ª.
‚Ä¢ üçé –Ø–±–ª–æ–∫–∏ - 2 —à—Ç
‚Ä¢ ü´ò –ö–æ—Ä–∏—Ü–∞ - 1 —á.–ª.
‚Ä¢ üåø –í–∞–Ω–∏–ª–∏–Ω

üë®‚Äçüç≥ <b>–ü–†–û–¶–ï–°–° –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø:</b>
1. üßÄ –¢–≤–æ—Ä–æ–≥ –ø—Ä–æ—Ç–µ—Ä–µ—Ç—å —á–µ—Ä–µ–∑ —Å–∏—Ç–æ
2. ‚ûï –î–æ–±–∞–≤–∏—Ç—å —è–π—Ü–∞, –º–µ–¥, –º–∞–Ω–∫—É, –≤–∞–Ω–∏–ª–∏–Ω
3. üçé –Ø–±–ª–æ–∫–∏ –Ω–∞—Ä–µ–∑–∞—Ç—å –∫—É–±–∏–∫–∞–º–∏
4. üçØ –§–æ—Ä–º—É —Å–º–∞–∑–∞—Ç—å –º–∞—Å–ª–æ–º, –≤—ã–ª–æ–∂–∏—Ç—å —Ç–µ—Å—Ç–æ
5. ü´ò –ü–æ—Å—ã–ø–∞—Ç—å –∫–æ—Ä–∏—Ü–µ–π –∏ —è–±–ª–æ–∫–∞–º–∏
6. üî• –ó–∞–ø–µ–∫–∞—Ç—å 25 –º–∏–Ω—É—Ç –ø—Ä–∏ 180¬∞C

üç¥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>"""
        }

        return templates.get(f"{recipe_type}_{theme}", templates.get('neuro_breakfast'))

# ========== –ú–û–ù–ò–¢–û–†–ò–ù–ì –°–ï–†–í–ò–°–ê ==========

class ServiceMonitor:
    def __init__(self):
        self.start_time = datetime.now()
        self.request_count = 0
        self.sent_messages = 0
        self.missed_messages = 0

    def increment_request(self):
        self.request_count += 1

    def record_sent_message(self):
        self.sent_messages += 1

    def record_missed_message(self, event_name):
        self.missed_messages += 1
        logger.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {event_name}")

    def get_status(self):
        return {
            "status": "healthy",
            "uptime_seconds": (datetime.now() - self.start_time).total_seconds(),
            "requests_handled": self.request_count,
            "sent_messages": self.sent_messages,
            "missed_messages": self.missed_messages,
            "timestamp": datetime.now().isoformat()
        }

service_monitor = ServiceMonitor()

# ========== –°–ò–°–¢–ï–ú–ê –í–†–ï–ú–ï–ù–ò ==========

class TimeManager:
    @staticmethod
    def kemerovo_to_server(kemerovo_time_str):
        """–ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø –í–†–ï–ú–ï–ù–ò –ö–ï–ú–ï–†–û–í–û ‚Üí –°–ï–†–í–ï–†"""
        try:
            kemerovo_now = datetime.now(Config.KEMEROVO_TZ)
            kemerovo_dt = datetime.strptime(kemerovo_time_str, '%H:%M').time()
            full_kemerovo_dt = datetime.combine(kemerovo_now.date(), kemerovo_dt)
            full_kemerovo_dt = Config.KEMEROVO_TZ.localize(full_kemerovo_dt)

            server_dt = full_kemerovo_dt.astimezone(Config.SERVER_TZ)
            return server_dt.strftime('%H:%M')

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ {kemerovo_time_str}: {e}")
            return kemerovo_time_str

    @staticmethod
    def get_current_times():
        server_now = datetime.now(Config.SERVER_TZ)
        kemerovo_now = datetime.now(Config.KEMEROVO_TZ)

        return {
            'server_time': server_now.strftime('%H:%M:%S'),
            'kemerovo_time': kemerovo_now.strftime('%H:%M:%S'),
            'server_date': server_now.strftime('%Y-%m-%d'),
            'kemerovo_date': kemerovo_now.strftime('%Y-%m-%d'),
            'kemerovo_weekday': kemerovo_now.weekday(),
            'kemerovo_weekday_name': ['–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'][kemerovo_now.weekday()]
        }

    @staticmethod
    def get_kemerovo_weekday():
        return datetime.now(Config.KEMEROVO_TZ).weekday()

# ========== –ú–ï–ù–ï–î–ñ–ï–† –í–ò–ó–£–ê–õ–¨–ù–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê ==========

class VisualContentManager:
    FOOD_PHOTOS = {
        'breakfast': [
            'https://images.unsplash.com/photo-1551782450-17144efb9c50?w=600',
            'https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?w=600',
        ],
        'lunch': [
            'https://images.unsplash.com/photo-1547592166-23ac45744acd?w=600',
            'https://images.unsplash.com/photo-1606755962773-d324e74532a7?w=600',
        ],
        'dinner': [
            'https://images.unsplash.com/photo-1563379926898-05f4575a45d8?w=600',
            'https://images.unsplash.com/photo-1598214886806-c87b84b707f5?w=600',
        ],
        'dessert': [
            'https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?w=600',
            'https://images.unsplash.com/photo-1571115764595-644a1f56a55c?w=600',
        ],
        'science': [
            'https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=600',
            'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=600',
        ]
    }

    # –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–ê–Ø –ö–û–ù–¶–û–í–ö–ê
    UNIVERSAL_FOOTER = """
‚îÄ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ ‚ãÖ‚àô‚àò ‚òÖ ‚àò‚àô‚ãÖ ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÄ

üéØ –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–π –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∏–∏

üì¢ –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å ‚Üí @ppsupershef
üí¨ –û–±—Å—É–∂–¥–∞–µ–º —Ä–µ—Ü–µ–ø—Ç—ã ‚Üí @ppsupershef_chat

üòã –í–∫—É—Å–Ω–æ | üí™ –ü–æ–ª–µ–∑–Ω–æ | ‚è±Ô∏è –ë—ã—Å—Ç—Ä–æ | üß† –ù–∞—É—á–Ω–æ

üîÑ –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏! ‚Üí @ppsupershef"""

    # –ù–ê–£–ß–ù–´–ï –ü–û–î–•–û–î–´ –° –û–ë–û–°–ù–û–í–ê–ù–ò–ï–ú –î–ù–Ø
    SCIENCE_APPROACHES = {
        'monday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö–ê:
–ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö –º–æ–∑–≥ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —É—Å–∏–ª–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. 
–•–æ–ª–∏–Ω –∏–∑ —è–∏—Ü + –û–º–µ–≥–∞-3 –∏–∑ –ª–æ—Å–æ—Å—è —Å–æ–∑–¥–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ –∞—Ü–µ—Ç–∏–ª—Ö–æ–ª–∏–Ω–∞ 
–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π –ø–æ—Å–ª–µ weekend-—Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏.""",
        
        'tuesday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –í–¢–û–†–ù–ò–ö–ê:
–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ –º—ã—à—Ü—ã –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏. –õ–µ–π—Ü–∏–Ω –∏–∑ —è–∏—Ü –∏ —Ç–≤–æ—Ä–æ–≥–∞ 
–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç mTOR –ø—É—Ç—å, —É—Å–∏–ª–∏–≤–∞—è —Å–∏–Ω—Ç–µ–∑ –º—ã—à–µ—á–Ω–æ–≥–æ –±–µ–ª–∫–∞ –Ω–∞ 40% –ø–æ—Å–ª–µ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏—á–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫.""",
        
        'wednesday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –°–†–ï–î–´:
–ö —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø–∏–∫ —Ç–æ–∫—Å–∏—á–µ—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –æ—Ç –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ä–µ–¥—ã –∏ —Å—Ç—Ä–µ—Å—Å–∞. 
–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –∏–∑ –æ–≤–æ—â–µ–π —Ñ–µ—Ä–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –º–∏–∫—Ä–æ–±–∏–æ–º–æ–º –≤ –±—É—Ç–∏—Ä–∞—Ç, —Å–Ω–∏–∂–∞—è —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ.""",
        
        'thursday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –ß–ï–¢–í–ï–†–ì–ê:
–ö –∫–æ–Ω—Ü—É —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–∏ –∏—Å—Ç–æ—â–∞—é—Ç—Å—è –∑–∞–ø–∞—Å—ã –≥–ª–∏–∫–æ–≥–µ–Ω–∞. –°–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã —Å –Ω–∏–∑–∫–∏–º –ì–ò 
–æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤—ã—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≥–ª—é–∫–æ–∑—ã, –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—è —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑–µ—Ä–≤—ã.""",
        
        'friday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –ü–Ø–¢–ù–ò–¶–´:
–í –ø—Ä–µ–¥–¥–≤–µ—Ä–∏–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –≤–∞–∂–µ–Ω –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–æ–π –∏ –≥–∏–±–∫–æ—Å—Ç—å—é. –ü—Ä–∏–Ω—Ü–∏–ø 80/20 
–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –º–æ–∑–≥–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—é –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏.""",
        
        'saturday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –°–£–ë–ë–û–¢–´:
–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –ø–∏—â–∏ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –ø–æ–≤—ã—à–∞–µ—Ç –æ–∫—Å–∏—Ç–æ—Ü–∏–Ω –Ω–∞ 27%, —É–∫—Ä–µ–ø–ª—è—è 
—Å–µ–º–µ–π–Ω—ã–µ —Å–≤—è–∑–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –ø–∏—â–µ–≤—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ —É –¥–µ—Ç–µ–π.""",
        
        'sunday': """üéØ –ù–ê–£–ß–ù–´–ô –ü–û–î–•–û–î –î–õ–Ø –í–û–°–ö–†–ï–°–ï–ù–¨–Ø:
–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ —Å–Ω–∏–∂–∞–µ—Ç decision fatigue –Ω–∞ 35% –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ 
–∏ –ø–æ–≤—ã—à–∞–µ—Ç adherence –∫ –∑–¥–æ—Ä–æ–≤–æ–º—É —Ä–∞—Ü–∏–æ–Ω—É –Ω–∞ 68%."""
    }

    def get_photo_for_recipe(self, recipe_type):
        photo_category = self._map_recipe_to_photo(recipe_type)
        photos = self.FOOD_PHOTOS.get(photo_category, self.FOOD_PHOTOS['breakfast'])
        return random.choice(photos)

    def _map_recipe_to_photo(self, recipe_type):
        mapping = {
            'neuro_breakfast': 'breakfast', 'energy_breakfast': 'breakfast',
            'protein_breakfast': 'breakfast', 'veggie_breakfast': 'breakfast',
            'carbs_breakfast': 'breakfast', 'family_breakfast': 'breakfast',
            'sunday_breakfast': 'breakfast', 'focus_lunch': 'lunch',
            'protein_lunch': 'lunch', 'veggie_lunch': 'lunch',
            'carbs_lunch': 'lunch', 'family_lunch': 'lunch',
            'sunday_lunch': 'lunch', 'brain_dinner': 'dinner',
            'protein_dinner': 'dinner', 'veggie_dinner': 'dinner',
            'family_dinner': 'dinner', 'week_prep_dinner': 'dinner',
            'friday_dessert': 'dessert', 'saturday_dessert': 'dessert',
            'sunday_dessert': 'dessert', 'neuro_advice': 'science',
            'protein_advice': 'science', 'veggie_advice': 'science',
            'carbs_advice': 'science', 'water_advice': 'science',
            'family_advice': 'science', 'planning_advice': 'science',
            'monday_science': 'science', 'tuesday_science': 'science',
            'wednesday_science': 'science', 'thursday_science': 'science',
            'friday_science': 'science', 'saturday_science': 'science',
            'sunday_science': 'science'
        }
        return mapping.get(recipe_type, 'breakfast')

    def generate_attractive_post(self, title, content, recipe_type, benefits, include_science_approach=False, day_of_week=None):
        photo_url = self.get_photo_for_recipe(recipe_type)
        
        # –ù–û–í–´–ô –§–û–†–ú–ê–¢ –ü–û–°–¢–ê
        post = f"""üçΩÔ∏è <b>{title}</b>

üì∏ <a href="{photo_url}">üñºÔ∏è –§–û–¢–û –ë–õ–Æ–î–ê</a>

{content}

üåü <b>–ü–û–õ–¨–ó–ê –î–õ–Ø –ó–î–û–†–û–í–¨–Ø:</b>
{benefits}"""

        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if include_science_approach and day_of_week:
            science_approach = self.SCIENCE_APPROACHES.get(day_of_week.lower())
            if science_approach:
                post += f"\n\n{science_approach}"

        # –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω—Ü–æ–≤–∫—É
        post += self.UNIVERSAL_FOOTER

        return post

    # –ù–ê–£–ß–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø
    def generate_monday_science(self):
        content = """
üß† –ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö: –ó–ê–ü–£–°–ö–ê–ï–ú –ú–û–ó–ì –ù–ê –ü–û–õ–ù–£–Æ –ú–û–©–ù–û–°–¢–¨!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø? 
–ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö –º–æ–∑–≥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ —Ä–µ–∂–∏–º–∞ –æ—Ç–¥—ã—Ö–∞ –≤ –∞–∫—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É. 
–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ø–∏–∫ –≤—ã—Ä–∞–±–æ—Ç–∫–∏ –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ –∏ –Ω–æ—Ä–∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞, —Ç—Ä–µ–±—É—é—â–∏–π 
—É—Å–∏–ª–µ–Ω–Ω–æ–π –Ω–µ–π—Ä–æ–ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:

‚Ä¢ üß© –û–ú–ï–ì–ê-3 –î–ì–ö - –∫—Ä–∏—Ç–∏—á–Ω–∞ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 
  –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö –º–µ–º–±—Ä–∞–Ω –ø–æ—Å–ª–µ weekend-—Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏
‚Ä¢ üí´ –•–û–õ–ò–ù - –ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫ –∞—Ü–µ—Ç–∏–ª—Ö–æ–ª–∏–Ω–∞, –¥–µ—Ñ–∏—Ü–∏—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ 
  –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ—â—É—Ç–∏–º –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
‚Ä¢ üõ°Ô∏è –ê–ù–¢–ò–û–ö–°–ò–î–ê–ù–¢–´ - –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–∫–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞, 
  –ø–∏–∫ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –ó–∞–ø—É—Å–∫ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ–π—Ä–æ–º–µ–¥–∏–∞—Ç–æ—Ä–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –≤ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã–π –¥–µ–Ω—å
‚Ä¢ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –Ω–µ–π—Ä–æ–ø—Ä–æ—Ç–µ–∫—Ü–∏—è –Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é
"""
        benefits = """‚Ä¢ üß† –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ 40%
‚Ä¢ üí° –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–∞–º—è—Ç–∏
‚Ä¢ ‚ö° –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –∏ —è—Å–Ω–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è"""
        
        return self.generate_attractive_post(
            "üß† –ù–ê–£–ö–ê –î–ù–Ø: –ü–ò–¢–ê–ù–ò–ï –î–õ–Ø –ú–û–ó–ì–ê",
            content, "monday_science", benefits,
            include_science_approach=True, day_of_week='monday'
        )

    def generate_tuesday_science(self):
        content = """
üí™ –í–¢–û–†–ù–ò–ö: –°–¢–†–û–ò–ú –°–ò–õ–¨–ù–û–ï –¢–ï–õ–û –ò –ú–´–®–¶–´!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–µ–ª–∫–æ–≤–æ–≥–æ –æ–±–º–µ–Ω–∞

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø?
–í—Ç–æ—Ä–Ω–∏–∫ - –ø–∏–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ –º—ã—à–µ—á–Ω–æ–≥–æ –±–µ–ª–∫–∞ –ø–æ—Å–ª–µ 
–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏—á–Ω—ã—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∏ —É–º—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫. –ß–µ—Ä–µ–∑ 24-48 —á–∞—Å–æ–≤ 
–ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è "–º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–æ–µ –æ–∫–Ω–æ" –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ 
—É—Å–≤–æ–µ–Ω–∏—è –Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:

‚Ä¢ üèóÔ∏è –ê–ù–ê–ë–û–õ–ò–ß–ï–°–ö–û–ï –û–ö–ù–û - –∏–º–µ–Ω–Ω–æ —Å–µ–≥–æ–¥–Ω—è –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º 
  —Å–∏–Ω—Ç–µ–∑–∞ –º—ã—à–µ—á–Ω–æ–≥–æ –±–µ–ª–∫–∞ –ø–æ—Å–ª–µ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
‚Ä¢ üß¨ –õ–ï–ô–¶–ò–ù - –∞–∫—Ç–∏–≤–∞—Ç–æ—Ä mTOR –ø—É—Ç–∏, –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω —á–µ—Ä–µ–∑ 
  24 —á–∞—Å–∞ –ø–æ—Å–ª–µ –Ω–∞–≥—Ä—É–∑–æ–∫
‚Ä¢ üîÑ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï - —Ä–µ–ø–∞—Ä–∞—Ü–∏—è —Ç–∫–∞–Ω–µ–π –∏ —Ñ–µ—Ä–º–µ–Ω—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º 
  –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–∏–∫–∞ –≤–æ –≤—Ç–æ—Ä–Ω–∏–∫

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–µ–∑ –º—ã—à–µ—á–Ω–æ–≥–æ –±–µ–ª–∫–∞
‚Ä¢ –£—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –Ω–µ–¥–µ–ª–∏
"""
        benefits = """‚Ä¢ üí™ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã –Ω–∞ 15-20%
‚Ä¢ üîÑ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –Ω–∞–≥—Ä—É–∑–æ–∫
‚Ä¢ üõ°Ô∏è –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–º–º—É–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ ‚ö° –ü–æ–≤—ã—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–º–µ–Ω–∞"""
        
        return self.generate_attractive_post(
            "üí™ –ù–ê–£–ö–ê –î–ù–Ø: –°–ò–õ–ê –ë–ï–õ–ö–û–í",
            content, "tuesday_science", benefits,
            include_science_approach=True, day_of_week='tuesday'
        )

    def generate_wednesday_science(self):
        content = """
ü•¨ –°–†–ï–î–ê: –î–ï–¢–û–ö–° –ò –í–ò–¢–ê–ú–ò–ù–ù–´–ô –ë–£–°–¢!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: –æ—á–∏—â–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø?
–°—Ä–µ–¥–∞ - –ø–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –º–µ—Ç–∞–±–æ–ª–∏—Ç–æ–≤ –∏ —Ç–æ–∫—Å–∏–Ω–æ–≤ –∑–∞ –ø–µ—Ä–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –Ω–µ–¥–µ–ª–∏. 
–û—Ä–≥–∞–Ω–∏–∑–º –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–µ—Ç–æ–∫—Å-–Ω–∞–≥—Ä—É–∑–∫–∏, –∞–∫—Ç–∏–≤–∏—Ä—É—è —Ñ–µ—Ä–º–µ–Ω—Ç–Ω—ã–µ 
—Å–∏—Å—Ç–µ–º—ã –ø–µ—á–µ–Ω–∏ II —Ñ–∞–∑—ã –¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–∏.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–ò–°–¢–ï–ú–ê:

‚Ä¢ üßπ –ü–ò–ö –¢–û–ö–°–ò–ß–ï–°–ö–û–ô –ù–ê–ì–†–£–ó–ö–ò - –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ –Ω–µ–¥–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è 
  –º–∞–∫—Å–∏–º—É–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞
‚Ä¢ üåø –ö–õ–ï–¢–ß–ê–¢–ö–ê - –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–∞ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∏ –≤—ã–≤–µ–¥–µ–Ω–∏—è 
  —Ç–æ–∫—Å–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ –ñ–ö–¢
‚Ä¢ üõ°Ô∏è –§–ò–¢–û–ù–£–¢–†–ò–ï–ù–¢–´ - –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≥–ª—É—Ç–∞—Ç–∏–æ–Ω-S-—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–∑—ã, 
  –∫–ª—é—á–µ–≤–æ–≥–æ —Ñ–µ—Ä–º–µ–Ω—Ç–∞ –¥–µ—Ç–æ–∫—Å–∞ II —Ñ–∞–∑—ã

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ –æ—á–∏—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π
‚Ä¢ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–∏–∫—Ä–æ–±–∏–æ–º–∞ –∏ –¥–µ—Ç–æ–∫—Å-—Å–∏—Å—Ç–µ–º
‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –∫–æ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ –Ω–µ–¥–µ–ª–∏
"""
        benefits = """‚Ä¢ üßπ –û—á–∏—â–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –æ—Ç –º–µ—Ç–∞–±–æ–ª–∏—Ç–æ–≤
‚Ä¢ ü¶† –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–∞ –º–∏–∫—Ä–æ–±–∏–æ–º–∞ –Ω–∞ 40%
‚Ä¢ üõ°Ô∏è –°–Ω–∏–∂–µ–Ω–∏–µ –æ–∫–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–µ—Å—Å–∞
‚Ä¢ üí™ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–º–º—É–Ω–Ω–æ–π –∑–∞—â–∏—Ç—ã"""
        
        return self.generate_attractive_post(
            "ü•¨ –ù–ê–£–ö–ê –î–ù–Ø: –°–ò–õ–ê –û–í–û–©–ï–ô",
            content, "wednesday_science", benefits,
            include_science_approach=True, day_of_week='wednesday'
        )

    def generate_thursday_science(self):
        content = """
üç† –ß–ï–¢–í–ï–†–ì: –ó–ê–ü–ê–°–ê–ï–ú –≠–ù–ï–†–ì–ò–Æ –î–õ–Ø –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢–ò!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: —É—Å—Ç–æ–π—á–∏–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ –º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ñ–æ–∫—É—Å

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø?
–ö —á–µ—Ç–≤–µ—Ä–≥—É –∏—Å—Ç–æ—â–∞—é—Ç—Å—è –∑–∞–ø–∞—Å—ã –≥–ª–∏–∫–æ–≥–µ–Ω–∞, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ. 
–û—Ä–≥–∞–Ω–∏–∑–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —ç–Ω–¥–æ–≥–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏, —Ç—Ä–µ–±—É—è 
–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:

‚Ä¢ üèÉ‚Äç‚ôÇÔ∏è –í–û–°–ü–û–õ–ù–ï–ù–ò–ï –ì–õ–ò–ö–û–ì–ï–ù–ê - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è 
  —ç–Ω–µ—Ä–≥–∏–∏ –≤ –∫–æ–Ω—Ü–µ —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–∏
‚Ä¢ ‚ö° –°–õ–û–ñ–ù–´–ï –£–ì–õ–ï–í–û–î–´ - –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤—ã—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ 
  –≥–ª—é–∫–æ–∑—ã –±–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ –∏–Ω—Å—É–ª–∏–Ω–∞
‚Ä¢ üß† –ú–ï–¢–ê–ë–û–õ–ò–ß–ï–°–ö–ê–Ø –ì–ò–ë–ö–û–°–¢–¨ - —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ 
  —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∑–µ—Ä–≤–æ–≤
‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —É–º—Å—Ç–≤–µ–Ω–Ω–∞—è –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –≤—ã—Ö–æ–¥–Ω—ã–º
"""
        benefits = """‚Ä¢ ‚ö° –°—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ 6-8 —á–∞—Å–æ–≤
‚Ä¢ üß† –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ 25%
‚Ä¢ üèÉ‚Äç‚ôÇÔ∏è –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚Ä¢ üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è"""
        
        return self.generate_attractive_post(
            "üç† –ù–ê–£–ö–ê –î–ù–Ø: –≠–ù–ï–†–ì–ò–Ø –£–ì–õ–ï–í–û–î–û–í",
            content, "thursday_science", benefits,
            include_science_approach=True, day_of_week='thursday'
        )

    def generate_friday_science(self):
        content = """
üéâ –ü–Ø–¢–ù–ò–¶–ê: –ë–ê–õ–ê–ù–°, –†–ï–õ–ê–ö–° –ò –£–ú–ù–û–ï –£–î–û–í–û–õ–¨–°–¢–í–ò–ï!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø?
–ü—è—Ç–Ω–∏—Ü–∞ - –¥–µ–Ω—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–∏ –∫ –≤—ã—Ö–æ–¥–Ω—ã–º. –í–∞–∂–µ–Ω –±–∞–ª–∞–Ω—Å 
–º–µ–∂–¥—É –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ–º –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –∫ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π 
—Ä–∞–∑–≥—Ä—É–∑–∫–µ. –°–Ω–∏–∂–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞, –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ 
—Å–æ—Ü–∏–∞–ª—å–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:

‚Ä¢ üòä –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –†–ï–õ–ê–ö–° - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è 
  –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è weekend-—Å—Ä—ã–≤–æ–≤
‚Ä¢ üçΩÔ∏è –°–û–¶–ò–ê–õ–¨–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤–µ—á–µ—Ä–Ω–∏–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º 
  –±–µ–∑ —É—â–µ—Ä–±–∞ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è
‚Ä¢ ‚öñÔ∏è –ü–†–ò–ù–¶–ò–ü 80/20 - –æ–±—É—á–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞ —É–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ 
  –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–º—É –≤—ã–±–æ—Ä—É –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –≤—ã—Ö–æ–¥–Ω—ã—Ö
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ
‚Ä¢ –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –∏ –ø–æ–ª—å–∑–æ–π
"""
        benefits = """‚Ä¢ üòä –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
‚Ä¢ üçΩÔ∏è –£—Å–ø–µ—à–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
‚Ä¢ ‚öñÔ∏è –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∑–¥–æ—Ä–æ–≤—å–µ–º –∏ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º
‚Ä¢ üí´ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏–≤—ã—á–µ–∫"""
        
        return self.generate_attractive_post(
            "üéâ –ù–ê–£–ö–ê –î–ù–Ø: –ë–ê–õ–ê–ù–° –ò –£–î–û–í–û–õ–¨–°–¢–í–ò–ï",
            content, "friday_science", benefits,
            include_science_approach=True, day_of_week='friday'
        )

    def generate_saturday_science(self):
        content = """
üë®‚Äçüç≥ –°–£–ë–ë–û–¢–ê: –°–ï–ú–ï–ô–ù–ê–Ø –ú–ê–ì–ò–Ø –ù–ê –ö–£–•–ù–ï!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ –ø–∏—â–µ–≤–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø?
–°—É–±–±–æ—Ç–∞ - –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–º–µ–π–Ω—ã—Ö —Ç—Ä–∞–¥–∏—Ü–∏–π –ø–∏—Ç–∞–Ω–∏—è. 
–í relaxed-—Ä–µ–∂–∏–º–µ –±–µ–∑ —Å–ø–µ—à–∫–∏ –∏ —Å—Ç—Ä–µ—Å—Å–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ 
—Å–æ –∑–¥–æ—Ä–æ–≤–æ–π –µ–¥–æ–π, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –¥–µ—Ç–µ–π.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:

‚Ä¢ ‚ù§Ô∏è –°–û–í–ú–ï–°–¢–ù–û–ï –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–ï - –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –æ–∫—Å–∏—Ç–æ—Ü–∏–Ω–∞, 
  —É–∫—Ä–µ–ø–ª—è—é—â–µ–≥–æ —Å–µ–º–µ–π–Ω—ã–µ —Å–≤—è–∑–∏
‚Ä¢ üé® –ö–£–õ–ò–ù–ê–†–ù–û–ï –û–ë–†–ê–ó–û–í–ê–ù–ò–ï - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –ø–∏—â–µ–≤—ã—Ö 
  –ø—Ä–∏–≤—ã—á–µ–∫ —á–µ—Ä–µ–∑ –∏–≥—Ä–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
‚Ä¢ üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ú–ï–ñ–ü–û–ö–û–õ–ï–ù–ß–ï–°–ö–ê–Ø –ü–ï–†–ï–î–ê–ß–ê - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ–º–µ–π–Ω–æ–≥–æ 
  food heritage –∏ —Ç—Ä–∞–¥–∏—Ü–∏–π

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π –≤ —Å–µ–º—å–µ
‚Ä¢ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ –∑–¥–æ—Ä–æ–≤–æ–π –ø–∏—â–µ
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–ø–ª—ã—Ö –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏ —Ç—Ä–∞–¥–∏—Ü–∏–π
"""
        benefits = """‚Ä¢ üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–µ–º–µ–π–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ 35%
‚Ä¢ üé® –†–∞–∑–≤–∏—Ç–∏–µ –∫—É–ª–∏–Ω–∞—Ä–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤ —É –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏
‚Ä¢ üçΩÔ∏è –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –ø–∏—â–µ–≤—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫
‚Ä¢ üí´ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Å–µ–º–µ–π–Ω—ã—Ö —Ç—Ä–∞–¥–∏—Ü–∏–π"""
        
        return self.generate_attractive_post(
            "üë®‚Äçüç≥ –ù–ê–£–ö–ê –î–ù–Ø: –°–ï–ú–ï–ô–ù–ê–Ø –ö–£–•–ù–Ø",
            content, "saturday_science", benefits,
            include_science_approach=True, day_of_week='saturday'
        )

    def generate_sunday_science(self):
        content = """
üìù –í–û–°–ö–†–ï–°–ï–ù–¨–ï: –ò–ù–í–ï–°–¢–ò–¶–ò–Ø –í –£–°–ü–ï–®–ù–£–Æ –ù–ï–î–ï–õ–Æ!

‚ö°Ô∏è –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –§–û–ö–£–°: —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

üéØ –ü–û–ß–ï–ú–£ –ò–ú–ï–ù–ù–û –°–ï–ì–û–î–ù–Ø?
–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ - –¥–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –Ω–æ–≤–æ–π –Ω–µ–¥–µ–ª–µ. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è 
—Å–Ω–∏–∂–∞–µ—Ç cognitive load –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ 
–Ω–µ–∑–¥–æ—Ä–æ–≤—ã–µ –≤—ã–±–æ—Ä—ã –∏ —Å–æ–∑–¥–∞–µ—Ç feeling of control.

üéØ –ù–ê–£–ß–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:

‚Ä¢ üóìÔ∏è MEAL-PREP –°–ò–°–¢–ï–ú–ê - —Å–Ω–∏–∂–µ–Ω–∏–µ decision fatigue –Ω–∞ 35% 
  –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
‚Ä¢ ‚öñÔ∏è –ë–ê–õ–ê–ù–° –ú–ê–ö–†–û–ù–£–¢–†–ò–ï–ù–¢–û–í - —Ä–∞—Å—á–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π —Å —É—á–µ—Ç–æ–º 
  –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ üí∞ –≠–ö–û–ù–û–ú–ò–Ø –†–ï–°–£–†–°–û–í - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç
‚Ä¢ üéØ –ü–†–û–ê–ö–¢–ò–í–ù–´–ô –ü–û–î–•–û–î - —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ 
  —Å–æ–±–ª—é–¥–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê –î–ï–ù–¨:
‚Ä¢ –ß–µ—Ç–∫–∏–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é
‚Ä¢ –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–∞ –æ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π
‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–µ–Ω–µ–≥
‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞
"""
        benefits = """‚Ä¢ ‚è±Ô∏è –≠–∫–æ–Ω–æ–º–∏—è 5-7 —á–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é –Ω–∞ –≥–æ—Ç–æ–≤–∫–µ
‚Ä¢ üí∞ –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø–∏—Ç–∞–Ω–∏–µ –Ω–∞ 20-30%
‚Ä¢ üçΩÔ∏è –ì–∞—Ä–∞–Ω—Ç–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ –≤—Å—é –Ω–µ–¥–µ–ª—é
‚Ä¢ üòå –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–∞ –∏ decision fatigue"""
        
        return self.generate_attractive_post(
            "üìù –ù–ê–£–ö–ê –î–ù–Ø: –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï –ü–ò–¢–ê–ù–ò–Ø",
            content, "sunday_science", benefits,
            include_science_approach=True, day_of_week='sunday'
        )

    # –ú–ï–¢–û–î–´ –î–õ–Ø –†–ï–¶–ï–ü–¢–û–í
    def generate_neuro_breakfast(self):
        title = "üß† –û–ú–õ–ï–¢ –° –õ–û–°–û–°–ï–ú –ò –ê–í–û–ö–ê–î–û"
        
        nutrition_facts = """‚Ä¢ üî• –ö–∞–ª–æ—Ä–∏–∏: 320 –∫–∫–∞–ª
‚Ä¢ üçó –ë–µ–ª–∫–∏: 25 –≥
‚Ä¢ ü•ë –ñ–∏—Ä—ã: 22 –≥  
‚Ä¢ üåæ –£–≥–ª–µ–≤–æ–¥—ã: 8 –≥"""
        
        ingredients = """‚Ä¢ ü•ö –Ø–π—Ü–∞ - 8 —à—Ç
‚Ä¢ üêü –õ–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª–µ–Ω—ã–π - 200 –≥
‚Ä¢ ü•ë –ê–≤–æ–∫–∞–¥–æ - 2 —à—Ç
‚Ä¢ ü•¨ –®–ø–∏–Ω–∞—Ç - 100 –≥
‚Ä¢ üßÄ –°—ã—Ä —Ñ–µ—Ç–∞ - 100 –≥
‚Ä¢ üçÖ –ü–æ–º–∏–¥–æ—Ä—ã —á–µ—Ä—Ä–∏ - 150 –≥
‚Ä¢ ü´í –û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ - 2 —Å—Ç.–ª.
‚Ä¢ üå∂Ô∏è –°–ø–µ—Ü–∏–∏: –∫—É—Ä–∫—É–º–∞, —á–µ—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü"""
        
        cooking_steps = """1. ü•ö –Ø–π—Ü–∞ –≤–∑–±–∏—Ç—å —Å –∫—É—Ä–∫—É–º–æ–π –∏ –ø–µ—Ä—Ü–µ–º
2. ü•ë –ê–≤–æ–∫–∞–¥–æ –Ω–∞—Ä–µ–∑–∞—Ç—å –∫—É–±–∏–∫–∞–º–∏
3. ü•¨ –ù–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –æ–±–∂–∞—Ä–∏—Ç—å —à–ø–∏–Ω–∞—Ç
4. üç≥ –ó–∞–ª–∏—Ç—å —è–π—Ü–∞–º–∏, –¥–æ–±–∞–≤–∏—Ç—å –∞–≤–æ–∫–∞–¥–æ –∏ –ø–æ–º–∏–¥–æ—Ä—ã
5. üî• –ì–æ—Ç–æ–≤–∏—Ç—å –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –æ–≥–Ω–µ 7-8 –º–∏–Ω—É—Ç
6. üßÄ –ü–æ—Å—ã–ø–∞—Ç—å —Å—ã—Ä–æ–º —Ñ–µ—Ç–∞ –∏ –ª–æ—Å–æ—Å–µ–º"""
        
        benefits = """‚Ä¢ üß† –£–ª—É—á—à–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–∞–º—è—Ç—å
‚Ä¢ üí™ –°–æ–¥–µ—Ä–∂–∏—Ç –û–º–µ–≥–∞-3 –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è –º–æ–∑–≥–∞
‚Ä¢ üõ°Ô∏è –ë–æ–≥–∞—Ç –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–∞–º–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –Ω–µ–π—Ä–æ–Ω–æ–≤
‚Ä¢ ‚ö° –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤—É—é —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ 4-5 —á–∞—Å–æ–≤"""
        
        content = f"""
{nutrition_facts}

üõí <b>–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ –ù–ê 4 –ü–û–†–¶–ò–ò:</b>
{ingredients}

üë®‚Äçüç≥ <b>–ü–†–û–¶–ï–°–° –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø:</b>
{cooking_steps}

üç¥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>"""
        
        return self.generate_attractive_post(
            title, content, "neuro_breakfast", benefits,
            include_science_approach=True, day_of_week='monday'
        )

    def generate_protein_breakfast(self):
        title = "üí™ –¢–í–û–†–û–ñ–ù–ê–Ø –ó–ê–ü–ï–ö–ê–ù–ö–ê"
        
        nutrition_facts = """‚Ä¢ üî• –ö–∞–ª–æ—Ä–∏–∏: 280 –∫–∫–∞–ª
‚Ä¢ üçó –ë–µ–ª–∫–∏: 30 –≥
‚Ä¢ ü•ë –ñ–∏—Ä—ã: 12 –≥  
‚Ä¢ üåæ –£–≥–ª–µ–≤–æ–¥—ã: 15 –≥"""
        
        ingredients = """‚Ä¢ üßÄ –¢–≤–æ—Ä–æ–≥ 5% - 600 –≥
‚Ä¢ ü•ö –Ø–π—Ü–∞ - 3 —à—Ç
‚Ä¢ üåæ –ú–∞–Ω–∫–∞ - 3 —Å—Ç.–ª.
‚Ä¢ üçØ –ú–µ–¥ - 3 —Å—Ç.–ª.
‚Ä¢ üçé –Ø–±–ª–æ–∫–∏ - 2 —à—Ç
‚Ä¢ ü´ò –ö–æ—Ä–∏—Ü–∞ - 1 —á.–ª.
‚Ä¢ üåø –í–∞–Ω–∏–ª–∏–Ω"""
        
        cooking_steps = """1. üßÄ –¢–≤–æ—Ä–æ–≥ –ø—Ä–æ—Ç–µ—Ä–µ—Ç—å —á–µ—Ä–µ–∑ —Å–∏—Ç–æ
2. ‚ûï –î–æ–±–∞–≤–∏—Ç—å —è–π—Ü–∞, –º–µ–¥, –º–∞–Ω–∫—É, –≤–∞–Ω–∏–ª–∏–Ω
3. üçé –Ø–±–ª–æ–∫–∏ –Ω–∞—Ä–µ–∑–∞—Ç—å –∫—É–±–∏–∫–∞–º–∏
4. üçØ –§–æ—Ä–º—É —Å–º–∞–∑–∞—Ç—å –º–∞—Å–ª–æ–º, –≤—ã–ª–æ–∂–∏—Ç—å —Ç–µ—Å—Ç–æ
5. ü´ò –ü–æ—Å—ã–ø–∞—Ç—å –∫–æ—Ä–∏—Ü–µ–π –∏ —è–±–ª–æ–∫–∞–º–∏
6. üî• –ó–∞–ø–µ–∫–∞—Ç—å 25 –º–∏–Ω—É—Ç –ø—Ä–∏ 180¬∞C"""
        
        benefits = """‚Ä¢ üí™ –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –º—ã—à—Ü
‚Ä¢ ü¶¥ –ë–æ–≥–∞—Ç –∫–∞–ª—å—Ü–∏–µ–º –¥–ª—è –∫—Ä–µ–ø–∫–∏—Ö –∫–æ—Å—Ç–µ–π
‚Ä¢ üçó –ù–∞–¥–æ–ª–≥–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —á—É–≤—Å—Ç–≤–æ —Å—ã—Ç–æ—Å—Ç–∏
‚Ä¢ üåü –£–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É"""
        
        content = f"""
{nutrition_facts}

üõí <b>–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ –ù–ê 4 –ü–û–†–¶–ò–ò:</b>
{ingredients}

üë®‚Äçüç≥ <b>–ü–†–û–¶–ï–°–° –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø:</b>
{cooking_steps}

üç¥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>"""
        
        return self.generate_attractive_post(
            title, content, "protein_breakfast", benefits,
            include_science_approach=True, day_of_week='tuesday'
        )

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–µ—Ü–µ–ø—Ç–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ...

# ========== –¢–ï–õ–ï–ì–†–ê–ú –ú–ï–ù–ï–î–ñ–ï–† ==========

class TelegramManager:
    def __init__(self):
        self.token = Config.TELEGRAM_BOT_TOKEN
        self.channel = Config.TELEGRAM_CHANNEL
        self.base_url = f"https://api.telegram.org/bot{self.token}"
        self.sent_hashes = set()
        self.last_sent_times = {}
        self._member_count = 39

    def get_member_count(self):
        return self._member_count

    def send_with_fallback(self, text, event_name, max_retries=3):
        for attempt in range(max_retries):
            try:
                success = self.send_message(text)
                if success:
                    service_monitor.record_sent_message()
                    return True
                else:
                    logger.warning(f"‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å –¥–ª—è {event_name}")
                    time.sleep(10)
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ {attempt + 1}: {e}")
                time.sleep(10)

        logger.error(f"‚ùå –í—Å–µ {max_retries} –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å: {event_name}")
        service_monitor.record_missed_message(event_name)
        return False

    def send_message(self, text, parse_mode='HTML'):
        try:
            current_time = datetime.now()
            time_key = current_time.strftime('%Y-%m-%d %H:%M')

            if time_key in self.last_sent_times:
                time_diff = (current_time - self.last_sent_times[time_key]).total_seconds()
                if time_diff < 600:
                    logger.warning(f"‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç: {time_key}")
                    return False

            if not self.token or self.token == 'your-telegram-bot-token':
                logger.error("‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
                return False

            content_hash = hashlib.md5(text.encode()).hexdigest()
            if content_hash in self.sent_hashes:
                logger.warning("‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞")
                return False

            url = f"{self.base_url}/sendMessage"
            payload = {
                'chat_id': self.channel,
                'text': text,
                'parse_mode': parse_mode,
                'disable_web_page_preview': False
            }

            logger.info(f"üîó –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram...")
            response = requests.post(url, json=payload, timeout=30)

            if response.status_code == 200:
                result = response.json()
                if result.get('ok'):
                    self.sent_hashes.add(content_hash)
                    self.last_sent_times[time_key] = current_time
                    logger.info("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–Ω–∞–ª")
                    return True
                else:
                    logger.error(f"‚ùå –û—à–∏–±–∫–∞ Telegram API: {result.get('description')}")
            else:
                logger.error(f"‚ùå HTTP –æ—à–∏–±–∫–∞: {response.status_code}")

            return False

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: {str(e)}")
            return False

# ========== –ì–ï–ù–ï–†–ê–¢–û–† –ö–û–ù–¢–ï–ù–¢–ê ==========

class ContentGenerator:
    def __init__(self):
        self.visual_manager = VisualContentManager()
        self.gpt_generator = YandexGPTGenerator()

    def _generate_with_gpt(self, recipe_type, theme, benefits):
        try:
            recipe_content = self.gpt_generator.generate_recipe(recipe_type, theme)
            return self.visual_manager.generate_attractive_post(
                theme.upper(),
                recipe_content,
                recipe_type,
                benefits
            )
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {e}")
            return self._get_fallback_content(recipe_type, theme, benefits)

    def _get_fallback_content(self, recipe_type, theme, benefits):
        fallback_content = f"""
üìä <b>–ü–ò–©–ï–í–ê–Ø –¶–ï–ù–ù–û–°–¢–¨ –ù–ê –ü–û–†–¶–ò–Æ:</b>
‚Ä¢ üî• –ö–∞–ª–æ—Ä–∏–∏: 300-400 –∫–∫–∞–ª
‚Ä¢ üçó –ë–µ–ª–∫–∏: 20-30 –≥
‚Ä¢ ü•ë –ñ–∏—Ä—ã: 15-25 –≥
‚Ä¢ üåæ –£–≥–ª–µ–≤–æ–¥—ã: 20-30 –≥

üõí <b>–ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ –ù–ê 4 –ü–û–†–¶–ò–ò:</b>
‚Ä¢ ü•ï –°–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ –∏ –∑–µ–ª–µ–Ω—å
‚Ä¢ üçó –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–µ–ª–∫–∏
‚Ä¢ üåæ –ü–æ–ª–µ–∑–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã
‚Ä¢ ü´í –ü–æ–ª–µ–∑–Ω—ã–µ –∂–∏—Ä—ã

üë®‚Äçüç≥ <b>–ü–†–û–¶–ï–°–° –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø:</b>
1. ü•£ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
2. üç≥ –°–ª–µ–¥–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É —Ä–µ—Ü–µ–ø—Ç—É
3. üî• –ì–æ—Ç–æ–≤–∏—Ç—å —Å –ª—é–±–æ–≤—å—é –¥–ª—è —Å–µ–º—å–∏
4. üçΩÔ∏è –ü–æ–¥–∞–≤–∞—Ç—å –≥–æ—Ä—è—á–∏–º

üç¥ <b>–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!</b>"""

        return self.visual_manager.generate_attractive_post(
            theme.upper(),
            fallback_content,
            recipe_type,
            benefits
        )

    # –ú–ï–¢–û–î–´ –ì–ï–ù–ï–†–ê–¶–ò–ò
    def generate_monday_science(self):
        return self.visual_manager.generate_monday_science()

    def generate_tuesday_science(self):
        return self.visual_manager.generate_tuesday_science()

    def generate_wednesday_science(self):
        return self.visual_manager.generate_wednesday_science()

    def generate_thursday_science(self):
        return self.visual_manager.generate_thursday_science()

    def generate_friday_science(self):
        return self.visual_manager.generate_friday_science()

    def generate_saturday_science(self):
        return self.visual_manager.generate_saturday_science()

    def generate_sunday_science(self):
        return self.visual_manager.generate_sunday_science()

    def generate_neuro_breakfast(self):
        return self.visual_manager.generate_neuro_breakfast()

    def generate_protein_breakfast(self):
        return self.visual_manager.generate_protein_breakfast()

    def generate_focus_lunch(self):
        return self._generate_with_gpt('lunch', '–û–±–µ–¥ –¥–ª—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏', 
                                      'üß† –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–º—Å—Ç–≤–µ–Ω–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\nüí° –£–ª—É—á—à–∞–µ—Ç –ø–∞–º—è—Ç—å\n‚ö° –ó–∞—Ä—è–∂–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏–µ–π')

    def generate_protein_lunch(self):
        return self._generate_with_gpt('lunch', '–ë–µ–ª–∫–æ–≤—ã–π –æ–±–µ–¥', 
                                      'üí™ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º—ã—à—Ü—ã\nüçó –ù–∞–¥–æ–ª–≥–æ –Ω–∞—Å—ã—â–∞–µ—Ç\nüåü –£–∫—Ä–µ–ø–ª—è–µ—Ç –∫–æ—Å—Ç–∏')

    def generate_brain_dinner(self):
        return self._generate_with_gpt('dinner', '–£–∂–∏–Ω –¥–ª—è –º–æ–∑–≥–∞', 
                                      'üß† –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ —Å–Ω—É\nüí° –£–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞\nüåô –õ–µ–≥–∫–∏–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π')

    def generate_protein_dinner(self):
        return self._generate_with_gpt('dinner', '–ë–µ–ª–∫–æ–≤—ã–π —É–∂–∏–Ω', 
                                      'üí™ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞ –Ω–æ—á—å\nüçó –ù–∞–¥–æ–ª–≥–æ –Ω–∞—Å—ã—â–∞–µ—Ç\nüåü –£–∫—Ä–µ–ø–ª—è–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–º')

    def generate_neuro_advice(self):
        return self._generate_with_gpt('advice', '–°–æ–≤–µ—Ç: –ü–∏—Ç–∞–Ω–∏–µ –¥–ª—è –º–æ–∑–≥–∞', 
                                      'üß† –£–ª—É—á—à–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\nüí° –ü–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\nüåü –ó–∞–±–æ—Ç–∏—Ç—Å—è –æ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–º –∑–¥–æ—Ä–æ–≤—å–µ')

    def generate_protein_advice(self):
        return self._generate_with_gpt('advice', '–°–æ–≤–µ—Ç: –ó–Ω–∞—á–µ–Ω–∏–µ –±–µ–ª–∫–æ–≤', 
                                      'üí™ –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –æ—Ä–≥–∞–Ω–∏–∑–º–∞\nüçó –í–∞–∂–µ–Ω –¥–ª—è —Ä–æ—Å—Ç–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è\nüåü –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç')

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏...

# ========== –ü–õ–ê–ù–ò–†–û–í–©–ò–ö –ö–û–ù–¢–ï–ù–¢–ê ==========

class ContentScheduler:
    def __init__(self):
        # –ü–û–õ–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï
        self.kemerovo_schedule = {
            # –ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö (0)
            0: {
                "08:30": {"name": "üß† –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ü–∏—Ç–∞–Ω–∏–µ –¥–ª—è –º–æ–∑–≥–∞", "type": "science", "method": "generate_monday_science"},
                "09:00": {"name": "üß† –ù–µ–π—Ä–æ–∑–∞–≤—Ç—Ä–∞–∫: –û–º–ª–µ—Ç —Å –ª–æ—Å–æ—Å–µ–º", "type": "neuro_breakfast", "method": "generate_neuro_breakfast"},
                "13:00": {"name": "üç≤ –û–±–µ–¥ –¥–ª—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏", "type": "focus_lunch", "method": "generate_focus_lunch"},
                "19:00": {"name": "ü•ó –£–∂–∏–Ω –¥–ª—è –º–æ–∑–≥–∞", "type": "brain_dinner", "method": "generate_brain_dinner"},
                "20:00": {"name": "üß† –°–æ–≤–µ—Ç: –ù–µ–π—Ä–æ–ø–∏—Ç–∞–Ω–∏–µ", "type": "neuro_advice", "method": "generate_neuro_advice"}
            },
            # –í–¢–û–†–ù–ò–ö (1)
            1: {
                "08:30": {"name": "üí™ –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –°–∏–ª–∞ –±–µ–ª–∫–æ–≤", "type": "science", "method": "generate_tuesday_science"},
                "09:00": {"name": "üí™ –ë–µ–ª–∫–æ–≤—ã–π –∑–∞–≤—Ç—Ä–∞–∫: –¢–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞", "type": "protein_breakfast", "method": "generate_protein_breakfast"},
                "13:00": {"name": "üçó –ë–µ–ª–∫–æ–≤—ã–π –æ–±–µ–¥: –ò–Ω–¥–µ–π–∫–∞ —Å –∫–∏–Ω–æ–∞", "type": "protein_lunch", "method": "generate_protein_lunch"},
                "19:00": {"name": "üêü –£–∂–∏–Ω: –õ–æ—Å–æ—Å—å —Å –æ–≤–æ—â–∞–º–∏", "type": "protein_dinner", "method": "generate_protein_dinner"},
                "20:00": {"name": "üí™ –°–æ–≤–µ—Ç: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–µ–ª–∫–æ–≤", "type": "protein_advice", "method": "generate_protein_advice"}
            },
            # –°–†–ï–î–ê (2)
            2: {
                "08:30": {"name": "ü•¨ –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –°–∏–ª–∞ –æ–≤–æ—â–µ–π", "type": "science", "method": "generate_wednesday_science"},
                "09:00": {"name": "ü•¨ –û–≤–æ—â–Ω–æ–π –∑–∞–≤—Ç—Ä–∞–∫: –°–º—É–∑–∏-–±–æ—É–ª", "type": "veggie_breakfast", "method": "generate_veggie_breakfast"},
                "13:00": {"name": "ü•¶ –û–±–µ–¥: –û–≤–æ—â–Ω–æ–µ —Ä–∞–≥—É", "type": "veggie_lunch", "method": "generate_veggie_lunch"},
                "19:00": {"name": "ü•ë –£–∂–∏–Ω: –°–∞–ª–∞—Ç —Å –∞–≤–æ–∫–∞–¥–æ", "type": "veggie_dinner", "method": "generate_veggie_dinner"},
                "20:00": {"name": "ü•¨ –°–æ–≤–µ—Ç: –î–µ—Ç–æ–∫—Å –ø–∏—Ç–∞–Ω–∏–µ", "type": "veggie_advice", "method": "generate_veggie_advice"}
            },
            # –ß–ï–¢–í–ï–†–ì (3)
            3: {
                "08:30": {"name": "üç† –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –≠–Ω–µ—Ä–≥–∏—è —É–≥–ª–µ–≤–æ–¥–æ–≤", "type": "science", "method": "generate_thursday_science"},
                "09:00": {"name": "üç† –£–≥–ª–µ–≤–æ–¥–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫: –û–≤—Å—è–Ω–∞—è –∫–∞—à–∞", "type": "carbs_breakfast", "method": "generate_carbs_breakfast"},
                "13:00": {"name": "üçö –û–±–µ–¥: –ì—Ä–µ—á–∫–∞ —Å –æ–≤–æ—â–∞–º–∏", "type": "carbs_lunch", "method": "generate_carbs_lunch"},
                "19:00": {"name": "ü•î –£–∂–∏–Ω: –ó–∞–ø–µ—á–µ–Ω–Ω—ã–π –±–∞—Ç–∞—Ç", "type": "carbs_dinner", "method": "generate_carbs_dinner"},
                "20:00": {"name": "üç† –°–æ–≤–µ—Ç: –°–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã", "type": "carbs_advice", "method": "generate_carbs_advice"}
            },
            # –ü–Ø–¢–ù–ò–¶–ê (4)
            4: {
                "08:30": {"name": "üéâ –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ë–∞–ª–∞–Ω—Å –ø–∏—Ç–∞–Ω–∏—è", "type": "science", "method": "generate_friday_science"},
                "09:00": {"name": "ü•û –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫", "type": "balance_breakfast", "method": "generate_balance_breakfast"},
                "13:00": {"name": "üçù –û–±–µ–¥: –ü–∞—Å—Ç–∞ —Å —Å–æ—É—Å–æ–º", "type": "balance_lunch", "method": "generate_balance_lunch"},
                "19:00": {"name": "üçΩÔ∏è –£–∂–∏–Ω: –†—ã–±–∞ —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª–µ–º", "type": "balance_dinner", "method": "generate_balance_dinner"},
                "20:00": {"name": "üéâ –°–æ–≤–µ—Ç: –ü—Ä–∏–Ω—Ü–∏–ø 80/20", "type": "balance_advice", "method": "generate_balance_advice"}
            },
            # –°–£–ë–ë–û–¢–ê (5)
            5: {
                "08:30": {"name": "üë®‚Äçüç≥ –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –°–µ–º–µ–π–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ", "type": "science", "method": "generate_saturday_science"},
                "10:00": {"name": "üç≥ –°–µ–º–µ–π–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫: –°—ã—Ä–Ω–∏–∫–∏", "type": "family_breakfast", "method": "generate_family_breakfast"},
                "13:00": {"name": "üë®‚Äçüç≥ –°–µ–º–µ–π–Ω—ã–π –æ–±–µ–¥: –°—ã—Ä–Ω—ã–π —Å—É–ø", "type": "family_lunch", "method": "generate_family_lunch"},
                "16:00": {"name": "üéÇ –°–µ–º–µ–π–Ω—ã–π –¥–µ—Å–µ—Ä—Ç", "type": "saturday_dessert", "method": "generate_saturday_dessert"},
                "19:00": {"name": "üçΩÔ∏è –°–µ–º–µ–π–Ω—ã–π —É–∂–∏–Ω", "type": "family_dinner", "method": "generate_family_dinner"},
                "20:00": {"name": "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –°–æ–≤–µ—Ç: –ü–∏—Ç–∞–Ω–∏–µ –¥–ª—è —Å–µ–º—å–∏", "type": "family_advice", "method": "generate_family_advice"}
            },
            # –í–û–°–ö–†–ï–°–ï–ù–¨–ï (6)
            6: {
                "08:30": {"name": "üìù –ù–∞—É—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è", "type": "science", "method": "generate_sunday_science"},
                "10:00": {"name": "‚òÄÔ∏è –í–æ—Å–∫—Ä–µ—Å–Ω—ã–π –±—Ä–∞–Ω—á: –û–º–ª–µ—Ç", "type": "sunday_breakfast", "method": "generate_sunday_breakfast"},
                "13:00": {"name": "üõí –û–±–µ–¥ + –ø–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é", "type": "sunday_lunch", "method": "generate_sunday_lunch"},
                "16:00": {"name": "üç∞ –í–æ—Å–∫—Ä–µ—Å–Ω—ã–π –¥–µ—Å–µ—Ä—Ç", "type": "sunday_dessert", "method": "generate_sunday_dessert"},
                "19:00": {"name": "üìã –£–∂–∏–Ω –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏", "type": "week_prep_dinner", "method": "generate_week_prep_dinner"},
                "20:00": {"name": "üìù –°–æ–≤–µ—Ç: Meal prep —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏", "type": "planning_advice", "method": "generate_planning_advice"}
            }
        }

        self.server_schedule = self._convert_schedule_to_server()
        self.is_running = False
        self.telegram = TelegramManager()
        self.generator = ContentGenerator()

    def _convert_schedule_to_server(self):
        server_schedule = {}
        for day, day_schedule in self.kemerovo_schedule.items():
            server_schedule[day] = {}
            for kemerovo_time, event in day_schedule.items():
                server_time = TimeManager.kemerovo_to_server(kemerovo_time)
                server_schedule[day][server_time] = event
        return server_schedule

    def start_scheduler(self):
        if self.is_running:
            return

        logger.info("üöÄ –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")

        if not self.validate_generator_methods():
            logger.error("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏! –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –∑–∞–ø—É—â–µ–Ω.")
            return False

        schedule.clear()

        for day, day_schedule in self.server_schedule.items():
            for server_time, event in day_schedule.items():
                self._schedule_event(day, server_time, event)

        self.is_running = True
        self._run_scheduler()

        logger.info("‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω")
        return True

    def validate_generator_methods(self):
        missing_methods = []
        for day_schedule in self.kemerovo_schedule.values():
            for event in day_schedule.values():
                method_name = event['method']
                if not hasattr(self.generator, method_name):
                    missing_methods.append(method_name)

        if missing_methods:
            logger.error(f"‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã: {missing_methods}")
            return False

        logger.info("‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã")
        return True

    def _schedule_event(self, day, server_time, event):
        def job():
            try:
                current_times = TimeManager.get_current_times()
                logger.info(f"üïí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: {event['name']}")

                method_name = event['method']
                if hasattr(self.generator, method_name):
                    method = getattr(self.generator, method_name)
                    content = method()

                    if content:
                        content_with_time = f"{content}\n\n‚è∞ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {current_times['kemerovo_time']}"

                        success = self.telegram.send_with_fallback(
                            content_with_time, 
                            event['name'],
                            max_retries=3
                        )

                        if success:
                            logger.info(f"‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: {event['name']}")
                        else:
                            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: {event['name']}")
                    else:
                        logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç: {event['name']}")
                        service_monitor.record_missed_message(event['name'])
                else:
                    logger.error(f"‚ùå –ú–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω: {method_name}")
                    service_monitor.record_missed_message(event['name'])

            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞–Ω–∏–∏ {event['name']}: {str(e)}")
                service_monitor.record_missed_message(event['name'])

        job_func = getattr(schedule.every(), self._get_day_name(day))
        job_func.at(server_time).do(job)

        logger.info(f"üìå –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: {self._get_day_name(day).capitalize()} {server_time} - {event['name']}")

    def _get_day_name(self, day_num):
        days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday']
        return days[day_num]

    def _run_scheduler(self):
        def run():
            while self.is_running:
                try:
                    schedule.run_pending()
                    time.sleep(60)
                except Exception as e:
                    logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ü–∏–∫–ª–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞: {e}")
                    time.sleep(60)

        scheduler_thread = Thread(target=run, daemon=True)
        scheduler_thread.start()
        logger.info("‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ")

    def get_next_event(self):
        try:
            current_times = TimeManager.get_current_times()
            current_kemerovo_time = current_times['kemerovo_time'][:5]

            current_weekday = TimeManager.get_kemerovo_weekday()
            today_schedule = self.kemerovo_schedule.get(current_weekday, {})

            for time_str, event in sorted(today_schedule.items()):
                if time_str > current_kemerovo_time:
                    return time_str, event

            tomorrow = (current_weekday + 1) % 7
            tomorrow_schedule = self.kemerovo_schedule.get(tomorrow, {})
            if tomorrow_schedule:
                first_time = min(tomorrow_schedule.keys())
                return first_time, tomorrow_schedule[first_time]

            return "08:30", {"name": "–°–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç", "type": "general"}

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è: {e}")
            return "08:30", {"name": "–°–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç", "type": "general"}

# ========== FLASK –ú–ê–†–®–†–£–¢–´ ==========

@app.route('/')
def smart_dashboard():
    try:
        current_times = TimeManager.get_current_times()
        current_weekday = TimeManager.get_kemerovo_weekday()
        monitor_status = service_monitor.get_status()

        member_count = telegram_manager.get_member_count()
        next_time, next_event = content_scheduler.get_next_event()

        total_posts = 38
        posts_sent = monitor_status['sent_messages']
        posts_remaining = total_posts - posts_sent

        weekly_stats = {
            'posts_sent': posts_sent,
            'posts_remaining': posts_remaining,
            'total_posts': total_posts,
            'completion_percentage': int((posts_sent / total_posts) * 100) if total_posts > 0 else 0
        }

        today_schedule = content_scheduler.kemerovo_schedule.get(current_weekday, {})

        html = f"""
        <!DOCTYPE html>
        <html lang="ru">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>–£–º–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ @ppsupershef</title>
            <style>
                body {{ font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }}
                .container {{ max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }}
                .header {{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }}
                .stats-grid {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }}
                .stat-card {{ background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #667eea; }}
                .stat-number {{ font-size: 24px; font-weight: bold; color: #333; }}
                .stat-label {{ font-size: 14px; color: #666; margin-top: 5px; }}
                .schedule-item {{ display: flex; align-items: center; padding: 12px; margin: 8px 0; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745; }}
                .schedule-time {{ font-weight: bold; color: #333; min-width: 60px; }}
                .schedule-text {{ flex: 1; margin-left: 15px; }}
                .btn {{ background: #667eea; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }}
                .btn:hover {{ background: #5a6fd8; }}
                .progress {{ background: #e9ecef; border-radius: 10px; height: 20px; margin: 10px 0; }}
                .progress-bar {{ background: #28a745; height: 100%; border-radius: 10px; text-align: center; color: white; font-size: 12px; line-height: 20px; }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <h1>üé™ –£–º–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ @ppsupershef</h1>
                    <p>–ö–ª—É–± –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –ü–∏—Ç–∞–Ω–∏—è - 38 –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é —Å –Ω–∞—É—á–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                        <div>üü¢ –°–ò–°–¢–ï–ú–ê –ê–ö–¢–ò–í–ù–ê</div>
                        <div>‚è∞ –ö–µ–º–µ—Ä–æ–≤–æ: {current_times['kemerovo_time']}</div>
                        <div>üìÖ {current_times['kemerovo_weekday_name']}</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{weekly_stats['posts_sent']}/{weekly_stats['total_posts']}</div>
                        <div class="stat-label">üìä –ü–æ—Å—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{weekly_stats['completion_percentage']}%</div>
                        <div class="stat-label">üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{member_count}</div>
                        <div class="stat-label">üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{enhanced_keep_alive.ping_count}</div>
                        <div class="stat-label">üîÑ Keep-alive –ø–∏–Ω–≥–∏</div>
                    </div>
                </div>

                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h3>üéØ –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–¥–µ–ª–∏</h3>
                    <div class="progress">
                        <div class="progress-bar" style="width: {weekly_stats['completion_percentage']}%">{weekly_stats['completion_percentage']}%</div>
                    </div>
                    <p>–û—Å—Ç–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: {weekly_stats['posts_remaining']} –ø–æ—Å—Ç–æ–≤</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3>‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è</h3>
                        {"".join([f'''
                        <div class="schedule-item">
                            <div class="schedule-time">{time}</div>
                            <div class="schedule-text">{event["name"]}</div>
                        </div>
                        ''' for time, event in sorted(today_schedule.items())])}
                    </div>

                    <div>
                        <h3>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                        <button class="btn" onclick="testSend()">üß™ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏</button>
                        <button class="btn" onclick="testGPT()">ü§ñ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</button>
                        <button class="btn" onclick="forceKeepAlive()">üîÑ Keep-alive</button>

                        <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <h4>üéØ –°–ª–µ–¥—É—é—â–∏–π –ø–æ—Å—Ç</h4>
                            <p><strong>{next_time}</strong> - {next_event['name']}</p>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function testSend() {{
                    fetch('/test-send').then(r => r.json()).then(data => {{
                        alert(data.status === 'success' ? '‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω!' : '‚ùå –û—à–∏–±–∫–∞');
                    }});
                }}

                function testGPT() {{
                    fetch('/test-gpt').then(r => r.json()).then(data => {{
                        alert(data.status === 'success' ? '‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!' : '‚ùå –û—à–∏–±–∫–∞');
                    }});
                }}

                function forceKeepAlive() {{
                    fetch('/force-keep-alive').then(r => r.json()).then(data => {{
                        alert('Keep-alive: ' + data.ping_count + ' –ø–∏–Ω–≥–æ–≤');
                    }});
                }}

                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                setInterval(() => location.reload(), 30000);
            </script>
        </body>
        </html>
        """
        return html

    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞: {e}")
        return f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞: {str(e)}"

@app.route('/health')
def health_check():
    return jsonify(service_monitor.get_status())

@app.route('/test-send')
def test_send():
    success = telegram_manager.send_message("üß™ <b>–¢–ï–°–¢ –°–ò–°–¢–ï–ú–´</b>\n\n‚úÖ 38 –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é\nü§ñ –ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥\nüõ°Ô∏è –£—Å–∏–ª–µ–Ω–Ω—ã–π keep-alive\nüë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: " + str(telegram_manager.get_member_count()))
    return jsonify({"status": "success" if success else "error"})

@app.route('/test-gpt')
def test_gpt():
    try:
        test_content = content_generator.generate_monday_science()
        success = telegram_manager.send_message(test_content)
        return jsonify({"status": "success" if success else "error"})
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)})

@app.route('/force-keep-alive')
def force_keep_alive():
    enhanced_keep_alive.multi_layer_ping()
    return jsonify({"status": "forced", "ping_count": enhanced_keep_alive.ping_count})

# ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ó–ê–ü–£–°–ö ==========

security_manager = SecurityManager()
telegram_manager = TelegramManager()
content_generator = ContentGenerator()
content_scheduler = ContentScheduler()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
def signal_handler(sig, frame):
    logger.info('üö® –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏...')
    sys.exit(0)

def on_exit():
    logger.info("üî¥ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

signal.signal(signal.SIGINT, signal_handler)
atexit.register(on_exit)

try:
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—ã
    start_enhanced_keep_alive()
    success = content_scheduler.start_scheduler()

    if success:
        logger.info("üöÄ –°–ò–°–¢–ï–ú–ê –ó–ê–ü–£–©–ï–ù–ê")
        logger.info("ü§ñ –ù–∞—É—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã: –ê–ö–¢–ò–í–ù–´")
        logger.info("üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–Ω–∞: –ê–ö–¢–ò–í–ù–ê")
        logger.info(f"üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: {telegram_manager.get_member_count()}")

        # –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–ø—É—Å–∫–µ
        current_times = TimeManager.get_current_times()
        telegram_manager.send_with_fallback(f"""
üé™ <b>–°–ò–°–¢–ï–ú–ê @ppsupershef –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê!</b>

‚úÖ <b>–ó–∞–ø—É—â–µ–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>
‚Ä¢ üìä 38 –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é
‚Ä¢ üß† –ù–∞—É—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
‚Ä¢ ü§ñ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ üõ°Ô∏è –£—Å–∏–ª–µ–Ω–Ω—ã–π keep-alive
‚Ä¢ üì± –£–º–Ω—ã–π –¥–∞—à–±–æ—Ä–¥

‚è∞ –í—Ä–µ–º—è –ö–µ–º–µ—Ä–æ–≤–æ: {current_times['kemerovo_time']}
üìÖ –î–µ–Ω—å: {current_times['kemerovo_weekday_name']}

üí´ <b>–ö–∞–∂–¥—ã–π –ø–æ—Å—Ç —Ç–µ–ø–µ—Ä—å —Å –Ω–∞—É—á–Ω—ã–º –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º!</b>

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–ª—É–±—É –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è! üë®‚Äçüë©‚Äçüëß‚Äçüë¶
        """, "–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã")

    else:
        logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É")

except Exception as e:
    logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã: {e}")

if __name__ == '__main__':
    port = int(os.environ.get('PORT', 8080))

    print("üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã @ppsupershef")
    print("üéØ –ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω: 38 –ø–æ—Å—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é")
    print("üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –Ω–∞—É—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è")
    print("ü§ñ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: Yandex GPT + —à–∞–±–ª–æ–Ω—ã")
    print("üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–Ω–∞: –∞–∫—Ç–∏–≤–Ω–∞")
    print("üì± –î–∞—à–±–æ—Ä–¥: –¥–æ—Å—Ç—É–ø–µ–Ω")

    app.run(host='0.0.0.0', port=port, debug=False)
